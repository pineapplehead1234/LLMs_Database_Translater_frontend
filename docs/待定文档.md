# API æ¥å£æ–‡æ¡£

## ğŸ“‹ æ–‡æ¡£ä¿¡æ¯

- **é¡¹ç›®åç§°**: ç¿»è¯‘åº”ç”¨åç«¯API
- **ç‰ˆæœ¬**: 1.0.0
- **Base URL**: `http://localhost:8000`
- **Content-Type**: `multipart/form-data`
- **ç¿»è¯‘æ–¹å‘**: è‹±æ–‡ â†’ ä¸­æ–‡ï¼ˆå›ºå®šï¼‰
- **è®¤è¯**: æ— éœ€ç™»å½•

---

## ğŸ“¤ æ–‡æ¡£ä¸Šä¼ ç¿»è¯‘æ¥å£

### POST /api/document/upload

**åŠŸèƒ½æè¿°**: ä¸Šä¼ è‹±æ–‡æ–‡æ¡£å¹¶è‡ªåŠ¨ç¿»è¯‘æˆä¸­æ–‡ï¼Œè¿”å›åŸæ–‡ Markdownã€è¯‘æ–‡ Markdown å’Œæœ¯è¯­æ ‡æ³¨

**æ”¯æŒæ ¼å¼**: PDF, DOCX, Markdown (.md)

**ç¿»è¯‘æ–¹å‘**: è‹±æ–‡ â†’ ä¸­æ–‡ï¼ˆå›ºå®šï¼‰

---

### è¯·æ±‚å‚æ•°

| å‚æ•°å | ç±»å‹ | æ˜¯å¦å¿…éœ€ | è¯´æ˜ |
|--------|------|---------|------|
| files | File[] | âœ… å¿…éœ€ | æ–‡ä»¶æ•°ç»„ï¼Œæ”¯æŒå¤šæ–‡ä»¶ä¸Šä¼  |
| knowledgeBase | string | âŒ å¯é€‰ | çŸ¥è¯†åº“JSONå­—ç¬¦ä¸² |

#### knowledgeBase å‚æ•°æ ¼å¼

```json
[
  {
    "chinese": "ç¥ç»ç½‘ç»œ",
    "english": "Neural Network"
  },
  {
    "chinese": "æ·±åº¦å­¦ä¹ ",
    "english": "Deep Learning"
  }
]
```

---

### è¯·æ±‚ç¤ºä¾‹

```javascript
const formData = new FormData()
formData.append('files', file1)
formData.append('files', file2)

// å¯é€‰ï¼šæ·»åŠ çŸ¥è¯†åº“
const knowledgeBase = [
  { chinese: 'ç¥ç»ç½‘ç»œ', english: 'Neural Network' }
]
formData.append('knowledgeBase', JSON.stringify(knowledgeBase))

axios.post('/api/document/upload', formData)
```

**Python/FastAPI åç«¯æ¥æ”¶ç¤ºä¾‹**:
```python
@app.post("/api/document/upload")
async def upload_document(
    files: List[UploadFile] = File(...),
    knowledgeBase: Optional[str] = Form(None)
):
    # å¤„ç†é€»è¾‘...
    # å›ºå®šç¿»è¯‘æ–¹å‘ï¼šè‹±æ–‡ â†’ ä¸­æ–‡
```

---

### å“åº”æ ¼å¼

```typescript
{
  success: boolean,
  totalCount: number,
  successCount: number,
  results: Array<{
    fileId: string,
    filename: string,
    fileType: "pdf" | "docx" | "markdown",
    status: "success" | "error",
    error?: string,
    format?: "markdown",
    originalMarkdown?: string,
    translatedMarkdown?: string,
    termAnnotations?: Array<{
      term: string,
      translation: string,
      position: {
        start: number,
        end: number
      }
    }>
  }>
}
```

#### å“åº”å­—æ®µè¯´æ˜

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| success | boolean | æ•´ä½“æ˜¯å¦æˆåŠŸï¼ˆè‡³å°‘ä¸€ä¸ªæ–‡ä»¶æˆåŠŸä¸ºtrueï¼‰ |
| totalCount | number | ä¸Šä¼ çš„æ–‡ä»¶æ€»æ•° |
| successCount | number | æˆåŠŸå¤„ç†çš„æ–‡ä»¶æ•° |
| results | array | ç¿»è¯‘ç»“æœæ•°ç»„ |
| results[].fileId | string | æ–‡ä»¶å”¯ä¸€æ ‡è¯† |
| results[].filename | string | æ–‡ä»¶å |
| results[].fileType | string | æ–‡ä»¶ç±»å‹ |
| results[].status | string | å¤„ç†çŠ¶æ€ï¼šsuccess/error |
| results[].error | string | å¤±è´¥æ—¶çš„é”™è¯¯ä¿¡æ¯ |
| results[].format | string | Markdown æ ¼å¼æ ‡è¯†ï¼Œå›ºå®šä¸º `"markdown"` |
| results[].originalMarkdown | string | è§£æåçš„åŸæ–‡ Markdownï¼ˆæˆåŠŸæ—¶ï¼‰ |
| results[].translatedMarkdown | string | ç¿»è¯‘åçš„è¯‘æ–‡ Markdownï¼ˆæˆåŠŸæ—¶ï¼‰ |
| results[].termAnnotations | array | æœ¯è¯­æ ‡æ³¨ï¼ˆæˆåŠŸæ—¶ï¼‰ |
| termAnnotations[].term | string | æœ¯è¯­åŸæ–‡ |
| termAnnotations[].translation | string | æœ¯è¯­ç¿»è¯‘ |
| termAnnotations[].position.start | number | æœ¯è¯­åœ¨åŸæ–‡ä¸­çš„èµ·å§‹ç´¢å¼• |
| termAnnotations[].position.end | number | æœ¯è¯­åœ¨åŸæ–‡ä¸­çš„ç»“æŸç´¢å¼• |

> Markdown å†…å®¹å·²åœ¨æœåŠ¡ç«¯è¿›è¡Œ HTML è½¬ä¹‰ï¼Œå‰ç«¯æ¸²æŸ“æ—¶ä»éœ€æ­é…å…·å¤‡ XSS é˜²æŠ¤çš„ Markdown è§£æå™¨ã€‚

---

### å“åº”ç¤ºä¾‹

#### æˆåŠŸå“åº”

```json
{
  "success": true,
  "totalCount": 3,
  "successCount": 2,
  "results": [
    {
      "fileId": "abc123",
      "filename": "document.pdf",
      "fileType": "pdf",
      "status": "success",
      "format": "markdown",
      "originalMarkdown": "# Machine Learning and Neural Networks\n\nMachine Learning and Neural Networks are important technologies in Artificial Intelligence.",
      "translatedMarkdown": "# æœºå™¨å­¦ä¹ å’Œç¥ç»ç½‘ç»œ\n\næœºå™¨å­¦ä¹ å’Œç¥ç»ç½‘ç»œæ˜¯äººå·¥æ™ºèƒ½ä¸­çš„é‡è¦æŠ€æœ¯ã€‚",
      "termAnnotations": [
        {
          "term": "Machine Learning",
          "translation": "æœºå™¨å­¦ä¹ ",
          "position": {
            "start": 0,
            "end": 15
          }
        },
        {
          "term": "Neural Networks",
          "translation": "ç¥ç»ç½‘ç»œ",
          "position": {
            "start": 20,
            "end": 35
          }
        },
        {
          "term": "Artificial Intelligence",
          "translation": "äººå·¥æ™ºèƒ½",
          "position": {
            "start": 64,
            "end": 87
          }
        }
      ]
    },
    {
      "fileId": "def456",
      "filename": "large-file.pdf",
      "fileType": "pdf",
      "status": "error",
      "error": "æ–‡ä»¶è¿‡å¤§ï¼Œè¶…è¿‡50MBé™åˆ¶"
    },
    {
      "fileId": "ghi789",
      "filename": "report.docx",
      "fileType": "docx",
      "status": "success",
      "format": "markdown",
      "originalMarkdown": "Deep Learning is a subset of machine learning.",
      "translatedMarkdown": "æ·±åº¦å­¦ä¹ æ˜¯æœºå™¨å­¦ä¹ çš„ä¸€ä¸ªå­é›†ã€‚",
      "termAnnotations": [
        {
          "term": "Deep Learning",
          "translation": "æ·±åº¦å­¦ä¹ ",
          "position": {
            "start": 0,
            "end": 13
          }
        },
        {
          "term": "machine learning",
          "translation": "æœºå™¨å­¦ä¹ ",
          "position": {
            "start": 32,
            "end": 47
          }
        }
      ]
    }
  ]
}
```

#### å…¨éƒ¨å¤±è´¥å“åº”

```json
{
  "success": false,
  "totalCount": 2,
  "successCount": 0,
  "results": [
    {
      "fileId": "abc123",
      "filename": "document.pdf",
      "fileType": "pdf",
      "status": "error",
      "error": "æ–‡ä»¶æ ¼å¼ä¸æ”¯æŒ"
    },
    {
      "fileId": "def456",
      "filename": "corrupted.pdf",
      "fileType": "pdf",
      "status": "error",
      "error": "æ–‡ä»¶è§£æå¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ˜¯å¦æŸå"
    }
  ]
}
```